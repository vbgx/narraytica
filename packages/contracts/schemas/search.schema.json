{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://narralytica.ai/schemas/search.schema.json",
  "title": "SearchResponseV1",
  "type": "object",
  "additionalProperties": false,
  "required": ["items", "page"],
  "properties": {
    "items": {
      "type": "array",
      "description": "Search hits (merged lexical + vector).",
      "items": { "$ref": "#/$defs/item" }
    },
    "page": { "$ref": "#/$defs/page" }
  },
  "$defs": {
    "id": {
      "type": "string",
      "minLength": 1
    },
    "iso_datetime": {
      "type": "string",
      "description": "RFC3339 / ISO8601 date-time (UTC recommended)."
    },
    "item": {
      "type": "object",
      "additionalProperties": false,
      "required": ["segment", "score"],
      "properties": {
        "segment": { "$ref": "#/$defs/segment" },
        "video": {
          "anyOf": [{ "$ref": "#/$defs/video" }, { "type": "null" }]
        },
        "speaker": {
          "anyOf": [{ "$ref": "#/$defs/speaker" }, { "type": "null" }]
        },
        "highlights": {
          "type": ["array", "null"],
          "items": { "$ref": "#/$defs/highlight" }
        },
        "score": { "$ref": "#/$defs/score" }
      }
    },
    "segment": {
      "title": "SearchSegment",
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "video_id", "start_ms", "end_ms", "text"],
      "properties": {
        "id": { "$ref": "#/$defs/id" },
        "video_id": { "$ref": "#/$defs/id" },
        "transcript_id": {
          "anyOf": [{ "$ref": "#/$defs/id" }, { "type": "null" }]
        },
        "speaker_id": {
          "anyOf": [{ "$ref": "#/$defs/id" }, { "type": "null" }]
        },
        "segment_index": {
          "type": ["integer", "null"],
          "minimum": 0
        },
        "start_ms": {
          "type": "integer",
          "minimum": 0
        },
        "end_ms": {
          "type": "integer",
          "minimum": 0
        },
        "text": {
          "type": "string"
        },
        "language": {
          "type": ["string", "null"],
          "minLength": 2
        },
        "source": {
          "type": ["string", "null"]
        },
        "created_at": {
          "anyOf": [{ "$ref": "#/$defs/iso_datetime" }, { "type": "null" }]
        },
        "updated_at": {
          "anyOf": [{ "$ref": "#/$defs/iso_datetime" }, { "type": "null" }]
        }
      }
    },
    "video": {
      "title": "SearchVideo",
      "type": "object",
      "additionalProperties": false,
      "required": ["id"],
      "properties": {
        "id": { "$ref": "#/$defs/id" },
        "title": {
          "type": ["string", "null"]
        },
        "source": {
          "type": ["string", "null"]
        },
        "published_at": {
          "anyOf": [{ "$ref": "#/$defs/iso_datetime" }, { "type": "null" }]
        }
      }
    },
    "speaker": {
      "title": "SearchSpeaker",
      "type": "object",
      "additionalProperties": false,
      "required": ["id"],
      "properties": {
        "id": { "$ref": "#/$defs/id" },
        "name": {
          "type": ["string", "null"]
        }
      }
    },
    "highlight": {
      "title": "SearchHighlight",
      "type": "object",
      "additionalProperties": false,
      "required": ["field", "text"],
      "properties": {
        "field": {
          "type": "string",
          "enum": ["text", "title", "speaker", "metadata"]
        },
        "text": {
          "type": "string",
          "minLength": 1,
          "description": "Highlighted snippet (may contain tags like <em> depending on backend)."
        }
      }
    },
    "score": {
      "title": "SearchScore",
      "type": "object",
      "additionalProperties": false,
      "required": ["combined"],
      "properties": {
        "combined": {
          "type": "number",
          "description": "Final merged score."
        },
        "lexical": {
          "type": ["number", "null"],
          "description": "Optional lexical score (backend-dependent)."
        },
        "vector": {
          "type": ["number", "null"],
          "description": "Optional vector similarity score (backend-dependent)."
        },
        "lexical_rank": {
          "type": ["integer", "null"],
          "minimum": 1
        },
        "vector_rank": {
          "type": ["integer", "null"],
          "minimum": 1
        }
      }
    },
    "page": {
      "title": "SearchPage",
      "type": "object",
      "additionalProperties": false,
      "required": ["limit", "offset"],
      "properties": {
        "limit": {
          "type": "integer",
          "minimum": 1
        },
        "offset": {
          "type": "integer",
          "minimum": 0
        },
        "total": {
          "type": ["integer", "null"],
          "minimum": 0,
          "description": "Optional total hits after merge (may be omitted or null in V1)."
        }
      }
    }
  }
}
