rules:
  - id: R1_NO_HTTP_IN_PACKAGES
    description: "packages/** must not import HTTP framework/runtime symbols"
    severity: error
    paths:
      - "packages/**/*.py"
    forbidden_imports:
      - "fastapi"
      - "starlette"
      - "uvicorn"

  - id: R5_SEARCH_CORE_NO_INFRA
    description: "packages/search/** must remain pure (no infra, no network)"
    severity: error
    paths:
      - "packages/search/**/*.py"
    forbidden_imports:
      - "packages.search_infra"
      - "packages.search_infra.*"
      - "requests"
      - "opensearch"
      - "opensearchpy"
      - "elasticsearch"
      - "qdrant_client"

  - id: R2_ROUTES_NO_INFRA_CLIENTS
    description: "routes/** must not import DB/search clients directly"
    severity: error
    paths:
      - "services/api/src/routes/**/*.py"
    forbidden_imports:
      - "psycopg"
      - "asyncpg"
      - "sqlalchemy"
      - "opensearch"
      - "opensearchpy"
      - "elasticsearch"
      - "qdrant_client"

  - id: R4_NO_API_SEARCH_IMPL_FROM_ROUTES
    description: "routes/** must not import services.api.src.search implementation"
    severity: error
    paths:
      - "services/api/src/routes/**/*.py"
    forbidden_imports:
      - "services.api.src.search.*"

  - id: R3_WORKERS_NO_LOCAL_CLIENTS
    description: "workers/** must not own infra clients"
    severity: error
    paths:
      - "services/workers/**/src/**/*.py"
    forbidden_imports:
      - "psycopg"
      - "asyncpg"
      - "sqlalchemy"
      - "opensearch"
      - "opensearchpy"
      - "elasticsearch"
      - "qdrant_client"
