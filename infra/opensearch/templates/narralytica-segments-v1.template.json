{
  "name": "narralytica-segments-v1",
  "index_patterns": ["narralytica-segments-v1*"],
  "priority": 200,
  "template": {
    "settings": {
      "index": {
        "number_of_shards": 1,
        "number_of_replicas": 0,
        "refresh_interval": "1s"
      },
      "analysis": {
        "filter": {
          "segment_ascii_folding": {
            "type": "asciifolding",
            "preserve_original": true
          }
        },
        "analyzer": {
          "segment_text": {
            "type": "custom",
            "tokenizer": "standard",
            "filter": ["lowercase", "segment_ascii_folding"]
          },
          "segment_text_search": {
            "type": "custom",
            "tokenizer": "standard",
            "filter": ["lowercase", "segment_ascii_folding"]
          },
          "segment_text_prefix": {
            "type": "custom",
            "tokenizer": "standard",
            "filter": ["lowercase", "segment_ascii_folding"]
          }
        }
      }
    },
    "mappings": {
      "dynamic": "false",
      "properties": {
        "id": { "type": "keyword" },
        "tenant_id": { "type": "keyword" },

        "video_id": { "type": "keyword" },
        "transcript_id": { "type": "keyword" },
        "speaker_id": { "type": "keyword" },

        "segment_index": { "type": "integer" },
        "start_ms": { "type": "integer" },
        "end_ms": { "type": "integer" },

        "language": { "type": "keyword" },
        "source": { "type": "keyword" },

        "created_at": { "type": "date" },
        "updated_at": { "type": "date" },

        "text": {
          "type": "text",
          "analyzer": "segment_text",
          "search_analyzer": "segment_text_search",
          "fields": {
            "raw": { "type": "keyword", "ignore_above": 256 },
            "prefix": {
              "type": "text",
              "analyzer": "segment_text_prefix",
              "search_analyzer": "segment_text_search"
            }
          }
        },

        "metadata": {
          "type": "flattened"
        }
      }
    }
  },
  "_meta": {
    "version": "v1",
    "doc": "Segments search index template (lexical + filters)."
  }
}
