## Issue 03.07 â€” Worker indexer uses shared infra adapters (no local clients)

Title: refactor(workers): indexer uses shared infra adapters (no local OpenSearch/Qdrant clients)
Labels: workers, search, refactor, anti-drift
Priority: P0

Objective

The indexer worker must not own its own backend client implementations.
It must consume shared infra adapters to avoid duplicated IO code and configuration drift.

Principle

- packages/ stays pure (no network deps)
- IO adapters live in shared infra layer:
  - services/infra/search_backends/ (recommended)
  - OR packages/search_infra/ (acceptable) that depends on clients, while packages/search never depends on it

Target layout

services/infra/search_backends/
  opensearch_search.py     # LexicalSearchPort impl used by API
  qdrant_search.py         # VectorSearchPort impl used by API
  opensearch_index.py      # IndexWriter for indexer (bulk/upsert/delete)
  templates/               # mappings/settings

Scope

1) Identify indexer backend operations:
   - bulk index
   - upsert
   - delete
   - refresh/flush (if used)

2) Implement IndexWriter interface in infra (NOT packages/)
   - explicit config injection (index name, retries, timeouts)
   - idempotent operations where possible

3) Replace indexer local clients with imports from services/infra/search_backends/*
   - delete services/workers/indexer/src/opensearch/* and qdrant/* after migration

4) Add CI boundary:
   - indexer cannot import backend client libraries directly
   - only allowed import path is services/infra/search_backends/*

DoD

- No local OpenSearch/Qdrant client code left in indexer
- API + indexer share the same IO adapters/config surface
- Tests pass; integration tests remain optional and isolated

Risks

Indexing API differs from searching API.

Mitigation

Separate modules:
- opensearch_search.py vs opensearch_index.py
Avoid mixing concerns under a single "adapter" file.
